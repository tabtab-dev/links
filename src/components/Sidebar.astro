---
import { getCollection } from 'astro:content';

export interface Props {
  showAll?: boolean;
  currentCategory?: string;
}

const { showAll = false, currentCategory } = Astro.props;

// 获取所有链接数据
const links = await getCollection('links');

// 获取所有分类并统计每个分类的数量
const categories = [...new Set(links.map(link => link.data.category))];
const categoryCounts = categories.reduce((acc, category) => {
  acc[category] = links.filter(link => link.data.category === category).length;
  return acc;
}, {} as Record<string, number>);
---

<div class="p-4 h-full flex flex-col">
  <nav class="space-y-1 flex-1">
    <!-- 全部链接 -->
    <a 
      href="/"
      class={`flex items-center px-3 py-2.5 rounded-lg transition-all duration-200 ${
        showAll 
          ? 'bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 text-blue-600 dark:text-blue-400 shadow-sm' 
          : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700/50'
      }`}
    >
      <svg class="w-5 h-5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v0M8 5a2 2 0 00-2 2h8a2 2 0 00-2-2" />
      </svg>
      <span class="flex-1 text-left">全部链接</span>
      <span class="ml-2 text-xs font-medium bg-gray-100 dark:bg-gray-600 text-gray-600 dark:text-gray-300 rounded-full px-2 py-0.5">
        {links.length}
      </span>
    </a>

    <!-- 分类标题 -->
    <div class="px-3 pt-4 pb-2 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">
      分类
    </div>

    <!-- 分类列表 -->
    {categories.map(category => {
      const selectedCategory = currentCategory === category.toLowerCase();
      return (
        <a 
          href={`/category/${category.toLowerCase()}`}
          class={`flex items-center px-3 py-2.5 rounded-lg transition-all duration-200 ${
            selectedCategory 
              ? 'bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 text-blue-600 dark:text-blue-400 shadow-sm' 
              : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700/50'
          }`}
        >
          <svg class="w-5 h-5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
          </svg>
          <span class="flex-1 text-left truncate">{category}</span>
          <span class="ml-2 text-xs font-medium bg-gray-100 dark:bg-gray-600 text-gray-600 dark:text-gray-300 rounded-full px-2 py-0.5">
            {categoryCounts[category]}
          </span>
        </a>
      );
    })}
  </nav>

  <!-- 底部信息 -->
  <div class="mt-auto pt-4 border-t border-gray-200 dark:border-gray-700">
    <div class="text-center">
      <p class="text-xs text-gray-500 dark:text-gray-400">快速导航工具</p>
      <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">© 2024 TabLinks</p>
    </div>
  </div>
</div>