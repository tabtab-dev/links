---
export interface Props {
  currentPath?: string;
}

const { currentPath = '/' } = Astro.props;

// 移动端导航项
const navItems = [
  { name: '首页', path: '/', icon: 'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6' },
  { name: '分类', path: '/category', icon: 'M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z' },
  { name: '搜索', path: '#search', icon: 'M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z' },
];

// 判断当前页面是否激活
const isActive = (path: string) => {
  if (path === '/') return currentPath === '/';
  return currentPath.startsWith(path);
};
---

<!-- 移动端底部导航 - 现代化玻璃拟态设计 -->
<div class="fixed bottom-0 left-0 right-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-2xl border-t border-white/20 dark:border-gray-800/30 z-50 md:hidden shadow-[0_-8px_32px_rgba(0,0,0,0.08)] dark:shadow-[0_-8px_32px_rgba(0,0,0,0.2)]">
  <div class="flex justify-around items-center py-3 px-4">
    {navItems.map(item => (
      <a
        href={item.path}
        class={`group relative flex flex-col items-center justify-center py-2 px-2 rounded-2xl transition-all duration-300 transform ${
          isActive(item.path)
            ? 'text-blue-600 dark:text-blue-400 scale-105'
            : 'text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:scale-105'
        }`}
      >
        <!-- 背景激活效果 -->
        <div class={`absolute inset-0 rounded-2xl transition-all duration-300 ${
          isActive(item.path)
            ? 'bg-gradient-to-br from-blue-500/10 via-purple-500/10 to-pink-500/10 dark:from-blue-500/20 dark:via-purple-500/20 dark:to-pink-500/20'
            : 'group-hover:bg-gray-100/50 dark:group-hover:bg-gray-800/50'
        }`}></div>
        
        <!-- 图标容器 -->
        <div class="relative z-10 flex flex-col items-center">
          <div class={`p-2 rounded-xl transition-all duration-300 ${
            isActive(item.path)
              ? 'bg-gradient-to-br from-blue-500/20 to-purple-500/20 dark:from-blue-500/30 dark:to-purple-500/30'
              : ''
          }`}>
            <svg 
              class="w-5 h-5 transition-all duration-300" 
              fill="none" 
              stroke="currentColor" 
              viewBox="0 0 24 24"
            >
              <path 
                stroke-linecap="round" 
                stroke-linejoin="round" 
                stroke-width={isActive(item.path) ? 2.5 : 2} 
                d={item.icon} 
              />
            </svg>
          </div>
          <span class={`text-xs font-semibold mt-1 transition-all duration-300 ${
            isActive(item.path) ? 'font-bold' : 'font-medium'
          }`}>{item.name}</span>
        </div>
        
        <!-- 激活指示器 -->
        <div class={`absolute -top-1 w-8 h-1 rounded-full transition-all duration-300 ${
          isActive(item.path)
            ? 'bg-gradient-to-r from-blue-500 to-purple-500 scale-100'
            : 'scale-0'
        }`}></div>
      </a>
    ))}
  </div>
  <!-- 安全区域适配 - 现代化设计 -->
  <div class="h-safe bg-gradient-to-t from-white/80 dark:from-gray-900/80 to-transparent backdrop-blur-xl"></div>
</div>

<style>
  /* 为移动端导航添加安全区域 */
  @supports (padding-bottom: env(safe-area-inset-bottom)) {
    .h-safe {
      height: env(safe-area-inset-bottom);
    }
    .fixed.bottom-0 {
      padding-bottom: env(safe-area-inset-bottom);
    }
  }
  
  /* 自定义安全区域后备方案 */
  .h-safe {
    height: 1rem;
  }
  
  @supports (padding-bottom: env(safe-area-inset-bottom)) {
    .h-safe {
      height: env(safe-area-inset-bottom);
    }
  }
</style>

<!-- 移动端导航搜索功能 -->
<script is:inline>
  (function() {
    // 等待DOM加载完成
    function initMobileNavSearch() {
      const searchLink = document.querySelector('a[href="#search"]');
      if (!searchLink) return;

      // 阻止默认行为
      searchLink.addEventListener('click', function(e) {
        e.preventDefault();
        
        const searchInput = document.getElementById('search-input');
        
        if (searchInput) {
          // 如果搜索框已存在，聚焦到它
          searchInput.focus();
          searchInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
        } else {
          // 如果当前页面没有搜索框，跳转到首页
          window.location.href = '/#search';
        }
      });
    }

    // 立即执行或等待DOMContentLoaded
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMobileNavSearch);
    } else {
      initMobileNavSearch();
    }
  })();
</script>